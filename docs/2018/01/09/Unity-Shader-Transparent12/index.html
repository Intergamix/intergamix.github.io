<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Unity 透明渲染(翻译十二)</title>
    <meta name="description" content="本篇摘要:  支持镂空阴影  噪声  粗略的半透明阴影  镂空阴影和半透明阴影之间切换">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="www.damonc.top/2018/01/09/Unity-Shader-Transparent12/">
    <link rel="alternate" type="application/rss+xml" title="bitfeng" href="www.damonc.top/feed.xml ">
    


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?f7f1a5967e3927ea98597632f0a17ad9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>




  <!-- MathJax -->
  <script>
    /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */
    MathJax = {
        tex: {
        inlineMath: [              /* start/end delimiter pairs for in-line math */
            ['$','$'],
            ['\\(','\\)']
        ],
        displayMath: [             /* start/end delimiter pairs for display math */
            ['$$', '$$'],
            ['\\[', '\\]']
        ]
        }
    };
  </script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

</head>


  <body class="custom-background">
    
    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">bitfeng</a>
        <small>maybe useless, but interesting.</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/demo/">
                        
                            <i class="fa fa-play"></i>Demos
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="home-right-bar">
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">
            <!-- Content -->
            <div class="side content">
                <div> 目录 </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>

<div class="page clearfix" post>
    <div class="left">
        <h1>Unity 透明渲染(翻译十二)</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2018-01-09
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>catlikecoding
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#翻译" title="Category: 翻译" rel="category">翻译</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#Shader" title="Tag: Shader" rel="tag">Shader</a-->
        <b href="/tag/#Shader" title="Tag: Shader" rel="tag">Shader</b>&nbsp;
    
        <!--a href="/tag/#Unity3d" title="Tag: Unity3d" rel="tag">Unity3d</a-->
        <b href="/tag/#Unity3d" title="Tag: Unity3d" rel="tag">Unity3d</b>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#镂空阴影" id="markdown-toc-镂空阴影">镂空阴影</a>    <ul>
      <li><a href="#重写阴影" id="markdown-toc-重写阴影">重写阴影</a></li>
      <li><a href="#裁剪阴影片段" id="markdown-toc-裁剪阴影片段">裁剪阴影片段</a></li>
    </ul>
  </li>
  <li><a href="#局部阴影" id="markdown-toc-局部阴影">局部阴影</a>    <ul>
      <li><a href="#抖动阴影" id="markdown-toc-抖动阴影">抖动阴影</a></li>
      <li><a href="#vpos" id="markdown-toc-vpos">VPOS</a></li>
      <li><a href="#抖动处理" id="markdown-toc-抖动处理">抖动处理</a></li>
      <li><a href="#近似半透明" id="markdown-toc-近似半透明">近似半透明</a></li>
    </ul>
  </li>
  <li><a href="#组合剪影与淡出效果" id="markdown-toc-组合剪影与淡出效果">组合剪影与淡出效果</a>    <ul>
      <li><a href="#32-合并显示" id="markdown-toc-32-合并显示">3.2 合并显示</a></li>
    </ul>
  </li>
</ul>

<p>本篇摘要:</p>
<ul>
  <li>支持镂空阴影</li>
  <li>噪声</li>
  <li>粗略的半透明阴影</li>
  <li>镂空阴影和半透明阴影之间切换</li>
</ul>

<h2 id="镂空阴影">镂空阴影</h2>

<p>翻译11介绍了镂空渲染，可能也注意到了，物体的投射的阴影是物体本身的形状，跟镂空形状完全不一致。这是因为我们之前的Shader投射阴影只是简单的采样了光的方向和到达物体表面的距离，没有区分表面形状。
<!--url1 url2 url3 url4 url5
    代表一次加载多少张图
--></p>
<center class="half"><img class="fit-picture" src="https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender12/1692664-20200412182420148-1157761308.png" width="250" alt="loading failed, need vpn." /></center>
<font size="2.5">
            <center><i><a>不符合现实的半透明阴影.</a></i></center>    
        </font>

<h3 id="重写阴影">重写阴影</h3>

<p>为了将透明度考虑在内，需要在阴影投射pass通道访问alpha值。这意味着我们要采样albedo纹理。然而，当仅用opaque渲染模式时就不需要采样，为此需要适配Shader变体。</p>

<p>现在的Shader已经集成了两个变体阴影，一是针对PointLight立方体阴影，二是针对其他类型灯光。现在增加第三个变体。改造一下之前的Shadow.cginc-略</p>

<h3 id="裁剪阴影片段">裁剪阴影片段</h3>

<p>就像渲染镂空效果时，阴影的镂空也根据alpha值来决定是否丢弃片段。因此算法上大致相似，必要变量也相似。拷贝tint、albedo、renderingsettings。</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"UnityCG.cginc"</span><span class="cp">
</span>
<span class="n">float4</span> <span class="n">_Tint</span><span class="p">;</span>
<span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
<span class="n">float4</span> <span class="n">_MainTex_ST</span><span class="p">,</span> <span class="n">_AlphaCutOff</span><span class="p">;</span>
</code></pre></div></div>

<p>当使用Cutout渲染模式就需要采样albedo纹理，但是只有当不使用albedo纹理alpha值作为平滑度时才能这样做(之前是把albedo`s alpha作为了平滑值，避免冲突)。如果满足上述条件，就可把uv坐标传递给片元程序。</p>

<p>写一个宏<code class="language-plaintext highlighter-rouge">_SHADOW_NEED_UV</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#if defined(_RENDERING_CUTOUT) &amp;&amp; !defined(_SMOOTHNESS_ALBEDO)
    #define _SHADOW_NEED_UV 1
#endif
</code></pre></div></div>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Interplotars</span> <span class="p">{</span>
    <span class="n">float4</span> <span class="n">position</span> <span class="o">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
<span class="cp">#if defined(_SHADOW_NEED_UV)
</span>    <span class="n">float2</span> <span class="n">uv</span>      <span class="o">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
<span class="cp">#endif
#if defined(SHADOWS_CUBE)
</span>    <span class="n">float3</span> <span class="n">lightVec</span> <span class="o">:</span> <span class="n">TEXCOORD1</span><span class="p">;</span>
<span class="cp">#endif
</span><span class="p">};</span>
</code></pre></div></div>

<p>实现宏_SHADOW_NEED_UV ，需要传递uv坐标时就采样</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if defined(_SHADOW_NEED_UV)
</span>        <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_MainTex</span><span class="p">);</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>拷贝GetAlpha函数，把厉害的宏替换为_SHADOW_NEED_UV</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//采样alpha</span>
<span class="kt">float</span> <span class="nf">GetAlpha</span><span class="p">(</span><span class="n">Interpolators</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">_Tint</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
<span class="cp">#if defined(_SHADOW_NEED_UV)
</span>    <span class="n">alpha</span> <span class="o">*=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span><span class="p">).</span><span class="n">a</span><span class="p">;</span>
<span class="cp">#endif
</span>    <span class="k">return</span> <span class="n">alpha</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>现在可以在fragment程序中获取alpha值，然后在Cutout渲染模式下使用clip裁切。</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kt">float</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">GetAlpha</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="cp">#if defined(_RENDERING_CUTOUT)
</span>    <span class="n">clip</span><span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="n">_AlphaCutOff</span><span class="p">);</span>
<span class="cp">#endif
</span></code></pre></div></div>

<!--url1 url2 url3 url4 url5
    代表一次加载多少张图
-->
<center class="half"><img class="fit-picture" src="https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender12/1692664-20200412201559342-431753371.png" width="250" alt="loading failed, need vpn." /></center>
<font size="2.5">
            <center><i><a>镂空阴影.</a></i></center>    
        </font>

<h2 id="局部阴影">局部阴影</h2>

<p>为了同时支持Fade和Transparent渲染模式的阴影，必须将其关键字添加到shadowCaster通道的着色器钟并定义ShaderFeature。</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#pragma shader_feature _ _RENDERING_CUTOUT _RENDERING_FADE _RENDERING_TRANSPARENT
</span></code></pre></div></div>

<p>在Fade和Transparent模式下阴影也应该是半透明的，定义宏_SHADOWS_SEMITRANSPARENT_</p>

<div file="cg" class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if defined(_RENDERING_FADE) || defined(_RENDERING_TRANSPARENT)
</span>    <span class="err">#</span><span class="n">define</span> <span class="n">SHADOWS_SEMITRANSPARENT</span> <span class="m">1</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>再次调整Shadeow_need_uv</p>

<div file="cg" class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if SHADOWS_SEMITRANSPARENT || defined(_RENDERING_CUTOUT)
</span>    <span class="err">#</span><span class="k">if</span> <span class="p">!</span><span class="nf">defined</span><span class="p">(</span><span class="n">_SMOOTHNESS_ALBEDO</span><span class="p">)</span>
        <span class="err">#</span><span class="n">define</span> <span class="n">SHADOWS_NEED_UV</span> <span class="m">1</span>
    <span class="err">#</span><span class="n">endif</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>这个时候由于是使用了Clip，还不能正确投射半透明阴影。继续！</p>

<h3 id="抖动阴影">抖动阴影</h3>

<p><strong>阴影贴图包含了光线到表面的距离。光线阻挡结果信息存在阴影贴图，存储的结果是：0或1。</strong>因此是没有办法指定光被半透明表面部分阻挡。</p>

<p>目前能做到的就是将阴影表面的一部分剪掉(镂空)。这就是为镂空阴影所做的。但是，除了基于阈值进行裁剪外，我们还可以裁剪片段。例如，如果一个表面让一半的光通过，并通过使用特定抖动纹理裁剪所有其他片段。就可以把生成的阴影显示为完整阴影的一半。</p>

<p>依靠纹理的alpha值，我们可以使用带有更多或更少孔的图案，就不会出现重复的模式。而且，如果我们混合使用这些模式，则可以对阴影的密度进行平滑过渡。基本上，我们仅使用两种状态来近似渐变。这种技术被称为抖动。<br />
Unity包含一个抖动模式图集，我们可以使用。它包含16种4×4像素的不同图案。它从一个完全空的模式开始。每个连续的模式填充一个额外的像素，直到有七个像素被填充。然后模式被反转和反转，直到所有像素都被填充。</p>

<h3 id="vpos">VPOS</h3>

<p>要对我们的阴影应用抖动模式，我们必须对其进行采样。 <strong>不能使用网格的UV坐标，因为它们在阴影空间中不一致</strong>。 相反，我们<strong>需要使用片段的屏幕空间坐标</strong>。 阴影是从光的视角角度渲染贴图的，这会使图案与阴影贴图对齐。</p>

<p>片段的屏幕空间坐标可以在片元程序中访问，方法是添加一个带有VPOS语义的参数。这些坐标不是由顶点程序显式输出的，但GPU可以程序用使用它们。</p>

<p>然而不幸的是，VPOS和SV_POSITION语义，在一些平台上，它们最终可能会映射到相同的语义位置。所以我们不能同时在我们的结构体中使用它们。幸运的是，我们只需要在顶点程序中使用SV_POSITION，而VPOS只需要在fragment程序中使用。所以分别为Vertex和Fragment程序定义一个单独的结构体。</p>

<h3 id="抖动处理">抖动处理</h3>

<p>要访问Unity的抖动模式纹理，需要增加变量__DitherMaskLOD_，不同模式存储在3D纹理的不同layer中，必须使用sampler3D声明。</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sampler3D</span> <span class="n">_DitherMaskLOD</span><span class="p">;</span>
</code></pre></div></div>

<p>如果需要半透明阴影，就在片元程序采样该纹理。通过<strong>tex3D</strong>采样，参数是__DitherMaskLOD_和一个3D坐标。由于该纹理有16种模式，模式选择由Z坐标决定，Z的范围是0-1。以0.0625增量步进。</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if SHADOWS_SEMITRANSPERANT
</span>    <span class="n">tex3D</span><span class="p">(</span><span class="n">_DitherMaskLOD</span><span class="p">,</span> <span class="n">float3</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">vpos</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">0625</span><span class="p">));</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>采样该纹理的目的是取得改纹理的alpha通道，再使用它减去一个较小值，然后用clip裁剪掉</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if SHADOWS_SEMITRANSPERANT
</span>    <span class="kt">float</span> <span class="n">dither</span> <span class="o">=</span> <span class="n">tex3D</span><span class="p">(</span><span class="n">_DitherMaskLOD</span><span class="p">,</span> <span class="n">float3</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">vpos</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">0625</span><span class="p">)).</span><span class="n">a</span><span class="p">;</span>
    <span class="n">clip</span><span class="p">(</span><span class="n">dither</span> <span class="err">–</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">);</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>要真正看到该模式纹理显示，需要调整显示密度大小，这可以通过将纹理的坐标位置乘以0.01来实现的。聚光灯的阴影下观察它。Z值从0-1，纹理将从不渲染到完全渲染。</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tex3D</span><span class="p">(</span><span class="n">_DitherMaskLOD</span><span class="p">,</span> <span class="n">float3</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">vpos</span><span class="p">.</span><span class="n">xy</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">0625</span><span class="p">))</span>
</code></pre></div></div>

<!--url1 url2 url3 url4 url5
    代表一次加载多少张图
-->
<center class="half"><img class="fit-picture" src="https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender12/1692664-20200428205642441-1330031621.png" width="250" alt="loading failed, need vpn." /><body></body>
        <img class="fit-picture" src="https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender12/1692664-20200428205643142-135343432.png" width="250" alt="loading failed, need vpn." /></center>
<font size="2.5">
            <center><i><a>Dither抖动纹理 0.0625 vs. 0.9375.</a></i></center>    
        </font>

<h3 id="近似半透明">近似半透明</h3>

<p>根据tex3D采样函数，可知Z坐标值决定是否要渲染片元。那么只需将该片元的alpha值与最高LOD层级(15/16=0.9375)相乘，得出该片元alpha所在的LOD层级。</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tex3D</span><span class="p">(</span><span class="n">_DitherMaskLOD</span><span class="p">,</span> <span class="n">float3</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">vpos</span><span class="p">.</span><span class="n">xy</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9375</span><span class="p">))</span>
</code></pre></div></div>

<!--url1 url2 url3 url4 url5
    代表一次加载多少张图
-->
<center class="half"><img class="fit-picture" src="https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender12/1692664-20200428205643811-825807310.png" width="250" alt="loading failed, need vpn." /></center>
<font size="2.5">
            <center><i><a>近似模拟半透.</a></i></center>    
        </font>

<p>抖动纹理密度大小可以缩放VPOS指定的纹理坐标实现，Unity使用了0.25值来缩放。</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tex3D</span><span class="p">(</span><span class="n">_DitherMaskLOD</span><span class="p">,</span> <span class="n">float3</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">vpos</span><span class="p">.</span><span class="n">xy</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9375</span><span class="p">))</span>
</code></pre></div></div>

<!--url1 url2 url3 url4 url5
    代表一次加载多少张图
-->
<center class="half"><img class="fit-picture" src="https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender12/1692664-20200428205644663-2080146283.png" width="250" alt="loading failed, need vpn." /></center>
<font size="2.5">
            <center><i><a>缩放后.</a></i></center>    
        </font>

<p>缩放后效果还行但不完美，这取决于抖动纹理的分辨率。越高的分辨率填充的越密集，效果越好。同时，抖动纹理在Hard和Soft阴影模式下的效果也不相同
<!--url1 url2 url3 url4 url5
    代表一次加载多少张图
--></p>
<center class="half"><img class="fit-picture" src="https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender12/1692664-20200428205645414-714577539.png" width="250" alt="loading failed, need vpn." /><body></body>
        <img class="fit-picture" src="https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender12/1692664-20200428205646528-1304295380.png" width="250" alt="loading failed, need vpn." /></center>
<font size="2.5">
            <center><i><a>soft vs. hard.</a></i></center>    
        </font>

<p>这个阴影模式在物体移动时有一个视觉错误，整个阴影都在动。密集恐惧。
<!--url1 url2 url3 url4 url5
    代表一次加载多少张图
--></p>
<center class="half"><img class="fit-picture" src="https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender12/1692664-20200428205648837-952005133.gif" width="250" alt="loading failed, need vpn." /></center>
<font size="2.5">
            <center><i><a>抖动.</a></i></center>    
        </font>

<h2 id="组合剪影与淡出效果">组合剪影与淡出效果</h2>

<p>可能Dither模式太难堪了，我们可能既想要投射阴影，也要半透明的效果。这就可以组合Cutout与Fade渲染。在阴影pass中增加一个新的关键字：</p>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_SEMITRANSPARENT_SHADOWS</span><span class="err">。若没有启用淡出半透阴影，回退到裁剪阴影。</span>
</code></pre></div></div>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#pragma shader_feature _ _SEMITRANSPARENT_SHADOWS
</span>
<span class="cp">#if defined(_RENDERING_FADE) || defined(_RENDERING_TRANSPARENT)
</span>    <span class="c1">//#define SHADOWS_SEMITRANSPARENT 1</span>
    <span class="cp">#if _SEMITRANSPARENT_SHADOWS
</span>        <span class="cp">#define SHADOWS_SEMITRANSPARENT 1  
</span>    <span class="cp">#elif         #define _RENDERING_CUTOUT
</span>    <span class="cp">#endif
#endif
</span></code></pre></div></div>

<p>上面这段代码加入后，会自动切换为裁剪阴影。</p>

<h3 id="32-合并显示">3.2 合并显示</h3>

<div file="cg" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">DoSimetransparentShadow</span><span class="p">(</span><span class="n">RenderMode</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">RenderMode</span><span class="p">.</span><span class="n">Fade</span> <span class="o">||</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">RenderMode</span><span class="p">.</span><span class="n">Transparent</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">EditorGUI</span><span class="p">.</span><span class="n">BeginChangeCheck</span><span class="p">();</span>
        <span class="n">bool</span> <span class="n">enable</span> <span class="o">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">Toggle</span>
        <span class="p">(</span>
            <span class="n">new</span> <span class="n">GUIContent</span><span class="p">(</span><span class="s">"Semitransparent Shadow"</span><span class="p">),</span>
            <span class="n">IsKeyEnable</span><span class="p">(</span><span class="s">"_SEMITRANSPARENT_SHADOWS"</span><span class="p">)</span>
        <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">enable</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">isShowCutoffAlpha</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">EditorGUI</span><span class="p">.</span><span class="n">EndChangeCheck</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">SetKeyword</span><span class="p">(</span><span class="s">"_SEMITRANSPARENT_SHADOWS"</span><span class="p">,</span> <span class="n">enable</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<!--url1 url2 url3 url4 url5
    代表一次加载多少张图
-->
<center class="half"><img class="fit-picture" src="https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender12/1692664-20200429002247947-969670121.png" width="250" alt="loading failed, need vpn." /></center>

        </article>
        <hr>

        
        
            
            
                
                    
                
                    
                
            
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2018/01/19/Unity-Static-Lightting16/">Unity 光照烘焙(翻译十六)
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2018/01/17/Unity-Deferred-Lights15/">Unity Deferred Lights-延迟光照(翻译十五)
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2018/01/15/Unity-Shader-Fog14/">Unity Shader Fog(翻译十四)
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2018/01/10/Unity-Deferred-Shading13/">Unity Shader 延迟渲染(翻译十三)
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2018/01/08/Unity-Shader-Transparent11/">Unity 透明渲染(翻译十一)
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2018/01/07/Unity-ShaderGUI-Extension10/">Unity Shader GUI 扩展二(翻译十)
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2018/01/08/Unity-Shader-Transparent11/">Unity 透明渲染(翻译十一)</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/2018/01/10/Unity-Deferred-Shading13/">Unity Shader 延迟渲染(翻译十三)</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        


<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    var disqus_config = function() {
        this.page.url = 'www.damonc.top/2018/01/09/Unity-Shader-Transparent12/'; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'www.damonc.top/2018/01/09/Unity-Shader-Transparent12/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//bitfeng.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





    </div>
</div>

<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             云上的日子！ 
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/bitfeng" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:damonc@126.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>        
        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>

    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });

      function displayWindowSize() {
            var w = document.documentElement.clientWidth;
            var h = document.documentElement.clientHeight;
            var rightDiv = document.querySelector('.right')
            var footer = document.querySelector('.site-footer')
            if(w <= 1700){
                rightDiv.style.display='none';
                footer.style.display='none';
            }else{
                rightDiv.style.display='block';
                footer.style.display = "block";
            }
        }

        // 将事件侦听器函数附加到窗口的resize事件
        window.addEventListener("resize", displayWindowSize);

        // 第一次调用该函数
        displayWindowSize();
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
