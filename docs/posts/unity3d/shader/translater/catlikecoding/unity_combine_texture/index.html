<!doctypehtml><html class=no-js lang=zh><meta charset=utf-8><meta content=on http-equiv=x-dns-prefetch-control><link href=//www.damonc.top rel=dns-prefetch><link href=//search.www.damonc.top rel=dns-prefetch><link href=//api.github.com rel=dns-prefetch><link href=//www.google-analytics.com rel=dns-prefetch><meta content=width=device-width,initial-scale=1 name=viewport><meta content=留点什么东西也挺不错的，偶尔会在这里停留。 name=description><meta content=银河揽月 name=author><link href=https://www.damonc.top/posts/unity3d/shader/translater/catlikecoding/unity_combine_texture/ rel=canonical><link href=../../../../../../favicon.ico rel=icon><meta content="mkdocs-1.4.2, mkdocs-material-8.5.11"name=generator><title>三UnityShader纹理融合 - 银河揽月</title><link href=../../../../../../assets/stylesheets/main.31645160.min.css rel=stylesheet><link href=../../../../../../assets/stylesheets/palette.2505c338.min.css rel=stylesheet><link href=../../../../../../extension/css/extra.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href=https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Mono:400,400i,700,700i&display=fallback rel=stylesheet><style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Mono"}@font-face {font-family:'Fira Sans';font-style:normal;font-weight:300;src:local('Fira Sans'),local('FiraSans-Normal'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.svg#FiraSans) format('svg')}@font-face {font-family:'Fira Sans';font-style:normal;font-weight:regular;src:local('Fira Sans'),local('FiraSans-Normal'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.svg#FiraSans) format('svg')}@font-face {font-family:'Fira Sans';font-style:italic;font-weight:regular;src:local('Fira Sans'),local('FiraSans-Italic'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.svg#FiraSans) format('svg')}@font-face {font-family:'Fira Sans';font-style:normal;font-weight:700;src:local('Fira Sans'),local('FiraSans-Normal'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.svg#FiraSans) format('svg')}@font-face {font-family:'Fira Mono';font-style:normal;font-weight:regular;src:local('Fira Mono'),local('FiraMono-Normal'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.svg#FiraMono) format('svg')}</style><script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head><body data-md-color-accent=red data-md-color-primary=white data-md-color-scheme=default dir=ltr><script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay for=__drawer></label><div data-md-component=skip><a class=md-skip href=#1-纹理合并> 跳转至 </a></div><div data-md-component=announce></div><header class=md-header data-md-component=header><nav class="md-header__inner md-grid"aria-label=页眉><a class="md-header__button md-logo"aria-label=银河揽月 data-md-component=logo href=../../../../../.. title=银河揽月> <img alt=logo src=../../../../../../images/homepage.png> </a><label class="md-header__button md-icon"for=__drawer><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> 银河揽月 </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> 三UnityShader纹理融合 </span></div></div></div><form class=md-header__option data-md-component=palette><input aria-label="Switch to dark mode"data-md-color-media="(prefers-color-scheme: light)"class=md-option data-md-color-accent=red data-md-color-primary=white data-md-color-scheme=default id=__palette_1 name=__palette type=radio><label class="md-header__button md-icon"title="Switch to dark mode"for=__palette_2 hidden><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg></label><input aria-label="Switch to light mode"data-md-color-media="(prefers-color-scheme: dark)"class=md-option data-md-color-accent=slate data-md-color-primary=slate data-md-color-scheme=slate id=__palette_2 name=__palette type=radio><label class="md-header__button md-icon"title="Switch to light mode"for=__palette_1 hidden><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg></label></form><label class="md-header__button md-icon"for=__search><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input aria-label=搜索 autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=搜索 required spellcheck=false><label class="md-search__icon md-icon"for=__search><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg></label><nav aria-label=查找 class=md-search__options><button class="md-search__icon md-icon"aria-label=清空当前内容 tabindex=-1 title=清空当前内容 type=reset><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg></button></nav></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>正在初始化搜索引擎</div><ol class=md-search-result__list></ol></div></div></div></div></div><div class=md-header__source><a class=md-source data-md-component=source href=https://github.com/damonc-top/damonc-top.github.io title=前往仓库> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512"xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg></div> <div class=md-source__repository>damonc-top</div> </a></div></nav></header><div class=md-container data-md-component=container><nav aria-label=标签 class=md-tabs data-md-component=tabs><div class="md-tabs__inner md-grid"><ul class=md-tabs__list><li class=md-tabs__item><a class=md-tabs__link href=../../../../../..> 首页 </a></li><li class=md-tabs__item><a class="md-tabs__link md-tabs__link--active"href=../../../../il2cpp/> Unity3D引擎 </a></li></ul></div></nav><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary"data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted"aria-label=导航栏 data-md-level=0><label class=md-nav__title for=__drawer><a class="md-nav__button md-logo"aria-label=银河揽月 data-md-component=logo href=../../../../../.. title=银河揽月> <img alt=logo src=../../../../../../images/homepage.png> </a> 银河揽月</label><div class=md-nav__source><a class=md-source data-md-component=source href=https://github.com/damonc-top/damonc-top.github.io title=前往仓库> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512"xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg></div> <div class=md-source__repository>damonc-top</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle"data-md-toggle=__nav_1 id=__nav_1 type=checkbox> <label class=md-nav__link for=__nav_1>首页 <span class="md-nav__icon md-icon"></span></label> <nav aria-label=首页 class=md-nav data-md-level=1><label class=md-nav__title for=__nav_1><span class="md-nav__icon md-icon"></span> 首页</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../../../../..> 简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../../../../home/learn/> 记录 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle"checked data-md-toggle=__nav_2 id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2>Unity3D引擎 <span class="md-nav__icon md-icon"></span></label> <nav aria-label=Unity3D引擎 class=md-nav data-md-level=1><label class=md-nav__title for=__nav_2><span class="md-nav__icon md-icon"></span> Unity3D引擎</label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle"data-md-toggle=__nav_2_1 id=__nav_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_1>il2cpp <span class="md-nav__icon md-icon"></span></label> <nav aria-label=il2cpp class=md-nav data-md-level=2><label class=md-nav__title for=__nav_2_1><span class="md-nav__icon md-icon"></span> il2cpp</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../../../il2cpp/> il2cpp简介 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle"checked data-md-toggle=__nav_2_2 id=__nav_2_2 type=checkbox> <label class=md-nav__link for=__nav_2_2>Shader <span class="md-nav__icon md-icon"></span></label> <nav aria-label=Shader class=md-nav data-md-level=2><label class=md-nav__title for=__nav_2_2><span class="md-nav__icon md-icon"></span> Shader</label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle"checked data-md-toggle=__nav_2_2_1 id=__nav_2_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_2_1>翻译CatlikeCoding <span class="md-nav__icon md-icon"></span></label> <nav aria-label=翻译CatlikeCoding class=md-nav data-md-level=3><label class=md-nav__title for=__nav_2_2_1><span class="md-nav__icon md-icon"></span> 翻译CatlikeCoding</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../> Catlikecoding简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../unity_matrix_transform/> 一UnityShader变换矩阵 </a></li><li class=md-nav__item><a class=md-nav__link href=../unity_shader_fundamentals/> 二UnityShader基本语法 </a></li><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle"data-md-toggle=toc id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active"for=__toc>三UnityShader纹理融合 <span class="md-nav__icon md-icon"></span></label> <a class="md-nav__link md-nav__link--active"href=./> 三UnityShader纹理融合 </a> <nav class="md-nav md-nav--secondary"aria-label=目录><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> 目录</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#1-纹理合并> 1. 纹理合并 </a> <nav aria-label="1. 纹理合并"class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#11-细节纹理> 1.1. 细节纹理 </a></li><li class=md-nav__item><a class=md-nav__link href=#12-多张纹理贴图采样> 1.2. 多张纹理贴图采样 </a></li><li class=md-nav__item><a class=md-nav__link href=#13-单独的细节纹理> 1.3. 单独的细节纹理 </a></li><li class=md-nav__item><a class=md-nav__link href=#14-使用两个uv> 1.4. 使用两个UV </a></li><li class=md-nav__item><a class=md-nav__link href=#15-细节纹理渐变融合> 1.5. 细节纹理渐变融合 </a></li><li class=md-nav__item><a class=md-nav__link href=#16-线性色彩空间> 1.6. 线性色彩空间 </a></li><li class=md-nav__item><a class=md-nav__link href=#17-什么是gamma色彩空间> 1.7. 什么是gamma色彩空间? </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=#2-纹理splat过渡遮罩> 2. 纹理splat过渡遮罩 </a> <nav aria-label="2. 纹理splat过渡遮罩"class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#21-增加融合纹理> 2.1. 增加融合纹理 </a></li><li class=md-nav__item><a class=md-nav__link href=#22-使用splat贴图> 2.2. 使用splat贴图 </a></li><li class=md-nav__item><a class=md-nav__link href=#23-rgb-splat贴图> 2.3. RGB Splat贴图 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=#3-结尾> 3. 结尾 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../unity_base_light/> 四UnityShader基础光照 </a></li></ul></nav></li></ul></nav></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary"data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--secondary"aria-label=目录><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> 目录</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#1-纹理合并> 1. 纹理合并 </a> <nav aria-label="1. 纹理合并"class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#11-细节纹理> 1.1. 细节纹理 </a></li><li class=md-nav__item><a class=md-nav__link href=#12-多张纹理贴图采样> 1.2. 多张纹理贴图采样 </a></li><li class=md-nav__item><a class=md-nav__link href=#13-单独的细节纹理> 1.3. 单独的细节纹理 </a></li><li class=md-nav__item><a class=md-nav__link href=#14-使用两个uv> 1.4. 使用两个UV </a></li><li class=md-nav__item><a class=md-nav__link href=#15-细节纹理渐变融合> 1.5. 细节纹理渐变融合 </a></li><li class=md-nav__item><a class=md-nav__link href=#16-线性色彩空间> 1.6. 线性色彩空间 </a></li><li class=md-nav__item><a class=md-nav__link href=#17-什么是gamma色彩空间> 1.7. 什么是gamma色彩空间? </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=#2-纹理splat过渡遮罩> 2. 纹理splat过渡遮罩 </a> <nav aria-label="2. 纹理splat过渡遮罩"class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#21-增加融合纹理> 2.1. 增加融合纹理 </a></li><li class=md-nav__item><a class=md-nav__link href=#22-使用splat贴图> 2.2. 使用splat贴图 </a></li><li class=md-nav__item><a class=md-nav__link href=#23-rgb-splat贴图> 2.3. RGB Splat贴图 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=#3-结尾> 3. 结尾 </a></li></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><a class="md-content__button md-icon"href=https://github.com/damonc-top/damonc-top.github.io/discussions/posts/unity3d/shader/translater/catlikecoding/unity_combine_texture.md title=编辑此页> <svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a><h1>三UnityShader纹理融合</h1><h2 id=1-纹理合并>1. 纹理合并<a title="Permanent link"class=headerlink href=#1-纹理合并></a></h2><p>贴图在游戏应用广泛，但它们有局限性。无论以何种尺寸显示，它们都有固定数量的像素。如果需要被渲染到很小网格，可以使用mipmap来保持它们的部分细节。但是当渲染到很大的网格上，会变得模糊。我们也不能无中生有地渲染更多额外的细节。本文讨论了一些解决办法。</p><h3 id=11-细节纹理>1.1. 细节纹理<a title="Permanent link"class=headerlink href=#11-细节纹理></a></h3><p>通常可以使用更大的纹理，意味着更多的像素和更多的细节。但是纹理的大小也是有限制的，取决于游戏包体大小和目标平台的内存，以及gpu采样能力。</p><p>另一种增加像素密度的方法是平铺纹理。出一张尽可能小的贴图，设置为重复模式。近距离观察下重复感可能不会很明显。毕竟当你站着用鼻子接触墙壁时，你只会看到整面墙壁的一小部分。</p><p>因此，我们能够通过拉伸与平铺纹理相结合的方式来尽可能地添加细节。为了尝试这一点，我们使用一张棱角明显的纹理。这是一个方格图，放入的工程内使用默认导入设置。</p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/grid.png title=略微扭曲的网格纹理></p><p>新建一个纹理融合shader<div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>Shader</span><span class=w> </span><span class=s>"Custom/Textured With Detail"</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>Properties</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>_Tint</span><span class=w> </span><span class=p>(</span><span class=s>"Tint"</span><span class=p>,</span><span class=w> </span><span class=n>Color</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w></span>
<span class=w>        </span><span class=n>_MainTex</span><span class=w> </span><span class=p>(</span><span class=s>"Texture"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>

<span class=w>    </span><span class=n>SubShader</span><span class=w> </span><span class=p>{</span><span class=w></span>

<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>使用此着色器创建一个新材质，然后为其指定该shader和网格纹理。 <img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/detailed-inspector.png title=Inspector-材质></p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/detailed-scene.png title=网格纹理></p><p>将材质分配给quad并查看它。从远处看效果还行。但是靠得太近看会变得模糊不清。缺失一些细节，同时纹理压缩造成的伪影也会变得很明显。 网格特写，显示低纹素密度和 DXT1 伪影。 多个纹理样本 <img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/grid-close-up.png title=带有低像素密度和DXT1伪影></p><h3 id=12-多张纹理贴图采样>1.2. 多张纹理贴图采样<a title="Permanent link"class=headerlink href=#12-多张纹理贴图采样></a></h3><p>现在我们只采样了单个纹理样本并将其用作片段着色器的结果，将采样的颜色存储在一个临时变量中。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kt>float4</span><span class=w> </span><span class=n>MyFragmentProgram</span><span class=w> </span><span class=p>(</span><span class=n>Interpolators</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>SV_TARGET</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kt>float4</span><span class=w> </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_Tint</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>color</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>先假设可以通过引入平铺纹理的方式来增加像素密度。执行一次纹理采样函数，给它一个十倍采样面积，用这个结果替换临时存储的颜色原来的颜色输出到屏幕。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kt>float4</span><span class=w> </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_Tint</span><span class=p>;</span><span class=w></span>
<span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>10</span><span class=p>);</span><span class=w></span>
<span class=k>return</span><span class=w> </span><span class=n>color</span><span class=p>;</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>屏幕上会产生很多小网格。靠的很近再观察，结果不那么糟糕了。因为采样纹理用了平铺10次，所以很明显是一个重复的图案。 硬编码平铺。 <img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/tiling.png title=平铺纹理></p><p>请注意，此时我们正在执行两个纹理采样，但最终却只使用其中一个。这似乎很浪费。是吗？看看编译的顶点程序。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>uniform</span><span class=w>  </span><span class=n>sampler2D</span><span class=w> </span><span class=n>_MainTex</span><span class=p>;</span><span class=w></span>
<span class=k>in</span><span class=w>  </span><span class=n>vec2</span><span class=w> </span><span class=n>vs_TEXCOORD0</span><span class=p>;</span><span class=w></span>
<span class=n>layout</span><span class=p>(</span><span class=n>location</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mo>0</span><span class=p>)</span><span class=w> </span><span class=k>out</span><span class=w> </span><span class=n>vec4</span><span class=w> </span><span class=n>SV_TARGET0</span><span class=p>;</span><span class=w></span>
<span class=n>vec2</span><span class=w> </span><span class=n>t0</span><span class=p>;</span><span class=w></span>
<span class=kt>void</span><span class=w> </span><span class=n>main</span><span class=p>()</span><span class=w></span>
<span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>t0</span><span class=p>.</span><span class=n>xy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vs_TEXCOORD0</span><span class=p>.</span><span class=n>xy</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>vec2</span><span class=p>(</span><span class=mf>10.0</span><span class=p>,</span><span class=w> </span><span class=mf>10.0</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>SV_TARGET0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>texture</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>t0</span><span class=p>.</span><span class=n>xy</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>SetTexture</span><span class=w> </span><span class=mo>0</span><span class=w> </span><span class=p>[</span><span class=n>_MainTex</span><span class=p>]</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=w> </span><span class=mo>0</span><span class=w></span>
<span class=w>      </span><span class=n>ps_4_0</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_sampler</span><span class=w> </span><span class=n>s0</span><span class=p>,</span><span class=w> </span><span class=n>mode_default</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_resource_texture2d</span><span class=w> </span><span class=p>(</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>)</span><span class=w> </span><span class=n>t0</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_input_ps</span><span class=w> </span><span class=k>linear</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xy</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_output</span><span class=w> </span><span class=n>o0</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_temps</span><span class=w> </span><span class=mi>1</span><span class=w></span>
<span class=w>   </span><span class=mo>0</span><span class=o>:</span><span class=w> </span><span class=nb>mul</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xy</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xyxx</span><span class=p>,</span><span class=w> </span><span class=n>l</span><span class=p>(</span><span class=mf>10.000000</span><span class=p>,</span><span class=w> </span><span class=mf>10.000000</span><span class=p>,</span><span class=w> </span><span class=mf>0.000000</span><span class=p>,</span><span class=w> </span><span class=mf>0.000000</span><span class=p>)</span><span class=w></span>
<span class=w>   </span><span class=mi>1</span><span class=o>:</span><span class=w> </span><span class=k>sample</span><span class=w> </span><span class=n>o0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyxx</span><span class=p>,</span><span class=w> </span><span class=n>t0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>s0</span><span class=w></span>
<span class=w>   </span><span class=mi>2</span><span class=o>:</span><span class=w> </span><span class=n>ret</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>是否注意到编译后的代码中只有一个纹理采样？没错，编译器为我们去掉了不必要的代码！编译器基本上会丢弃任何最终未使用的内容。</p><p>我们不想丢弃原始采样到颜色，就要合并两次采样结果。让我们通过将它们相乘来做到这一点。再添加一个_Tint属性，叠加一层自定义颜色。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kt>float4</span><span class=w> </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_Tint</span><span class=p>;</span><span class=w></span>
<span class=n>color</span><span class=w> </span><span class=o>*=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span><span class=w></span>
<span class=k>return</span><span class=w> </span><span class=n>color</span><span class=p>;</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>着色编译器会生成什么样的代码呢，对此有何影响？</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>uniform</span><span class=w>  </span><span class=n>sampler2D</span><span class=w> </span><span class=n>_MainTex</span><span class=p>;</span><span class=w></span>
<span class=k>in</span><span class=w>  </span><span class=n>vec2</span><span class=w> </span><span class=n>vs_TEXCOORD0</span><span class=p>;</span><span class=w></span>
<span class=n>layout</span><span class=p>(</span><span class=n>location</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mo>0</span><span class=p>)</span><span class=w> </span><span class=k>out</span><span class=w> </span><span class=n>vec4</span><span class=w> </span><span class=n>SV_TARGET0</span><span class=p>;</span><span class=w></span>
<span class=n>mediump</span><span class=w> </span><span class=n>vec4</span><span class=w> </span><span class=n>t16_0</span><span class=p>;</span><span class=w></span>
<span class=n>lowp</span><span class=w> </span><span class=n>vec4</span><span class=w> </span><span class=n>t10_0</span><span class=p>;</span><span class=w></span>
<span class=kt>void</span><span class=w> </span><span class=n>main</span><span class=p>()</span><span class=w></span>
<span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>t10_0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>texture</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>vs_TEXCOORD0</span><span class=p>.</span><span class=n>xy</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>t16_0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t10_0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>t10_0</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>SV_TARGET0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t16_0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_Tint</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>SetTexture</span><span class=w> </span><span class=mo>0</span><span class=w> </span><span class=p>[</span><span class=n>_MainTex</span><span class=p>]</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=w> </span><span class=mo>0</span><span class=w></span>
<span class=n>ConstBuffer</span><span class=w> </span><span class=s>"Globals"</span><span class=w> </span><span class=mi>144</span><span class=w></span>
<span class=n>Vector</span><span class=w> </span><span class=mi>96</span><span class=w> </span><span class=p>[</span><span class=n>_Tint</span><span class=p>]</span><span class=w></span>
<span class=n>BindCB</span><span class=w>  </span><span class=s>"Globals"</span><span class=w> </span><span class=mo>0</span><span class=w></span>
<span class=w>      </span><span class=n>ps_4_0</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_constantbuffer</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span><span class=w> </span><span class=n>immediateIndexed</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_sampler</span><span class=w> </span><span class=n>s0</span><span class=p>,</span><span class=w> </span><span class=n>mode_default</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_resource_texture2d</span><span class=w> </span><span class=p>(</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>)</span><span class=w> </span><span class=n>t0</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_input_ps</span><span class=w> </span><span class=k>linear</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xy</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_output</span><span class=w> </span><span class=n>o0</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_temps</span><span class=w> </span><span class=mi>1</span><span class=w></span>
<span class=w>   </span><span class=mo>0</span><span class=o>:</span><span class=w> </span><span class=k>sample</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xyxx</span><span class=p>,</span><span class=w> </span><span class=n>t0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>s0</span><span class=w></span>
<span class=w>   </span><span class=mi>1</span><span class=o>:</span><span class=w> </span><span class=nb>mul</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>2</span><span class=o>:</span><span class=w> </span><span class=nb>mul</span><span class=w> </span><span class=n>o0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>6</span><span class=p>].</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>3</span><span class=o>:</span><span class=w> </span><span class=n>ret</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>这次的纹理采样，编译器检测到重复对_MainTex采样代码。对其进行优化后纹理只采样一次，结果存储在寄存器中并重复使用。即使使用_Tint中间变量等，编译器也足够聪明，可以检测到此类代码重复。最终将所有结果汇总后输出。</p><p>现在再对UV坐标平铺×10次，最终看到大网格和小网格的融合在一起</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>color</span><span class=w> </span><span class=o>*=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>10</span><span class=p>);</span><span class=w></span>
</code></pre></div></td></tr></table></div><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/multiplied.png title=平铺纹理></p><p>由于纹理采样时参数不再相同，编译器也必须保留两次采样。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>uniform</span><span class=w>  </span><span class=n>sampler2D</span><span class=w> </span><span class=n>_MainTex</span><span class=p>;</span><span class=w></span>
<span class=k>in</span><span class=w>  </span><span class=n>vec2</span><span class=w> </span><span class=n>vs_TEXCOORD0</span><span class=p>;</span><span class=w></span>
<span class=n>layout</span><span class=p>(</span><span class=n>location</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mo>0</span><span class=p>)</span><span class=w> </span><span class=k>out</span><span class=w> </span><span class=n>vec4</span><span class=w> </span><span class=n>SV_TARGET0</span><span class=p>;</span><span class=w></span>
<span class=n>vec4</span><span class=w> </span><span class=n>t0</span><span class=p>;</span><span class=w></span>
<span class=n>lowp</span><span class=w> </span><span class=n>vec4</span><span class=w> </span><span class=n>t10_0</span><span class=p>;</span><span class=w></span>
<span class=n>vec2</span><span class=w> </span><span class=n>t1</span><span class=p>;</span><span class=w></span>
<span class=n>lowp</span><span class=w> </span><span class=n>vec4</span><span class=w> </span><span class=n>t10_1</span><span class=p>;</span><span class=w></span>
<span class=kt>void</span><span class=w> </span><span class=n>main</span><span class=p>()</span><span class=w></span>
<span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>t10_0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>texture</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>vs_TEXCOORD0</span><span class=p>.</span><span class=n>xy</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>t0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t10_0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_Tint</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>t1</span><span class=p>.</span><span class=n>xy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vs_TEXCOORD0</span><span class=p>.</span><span class=n>xy</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>vec2</span><span class=p>(</span><span class=mf>10.0</span><span class=p>,</span><span class=w> </span><span class=mf>10.0</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>t10_1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>texture</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>t1</span><span class=p>.</span><span class=n>xy</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>SV_TARGET0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>t10_1</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>SetTexture</span><span class=w> </span><span class=mo>0</span><span class=w> </span><span class=p>[</span><span class=n>_MainTex</span><span class=p>]</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=w> </span><span class=mo>0</span><span class=w></span>
<span class=n>ConstBuffer</span><span class=w> </span><span class=s>"Globals"</span><span class=w> </span><span class=mi>144</span><span class=w></span>
<span class=n>Vector</span><span class=w> </span><span class=mi>96</span><span class=w> </span><span class=p>[</span><span class=n>_Tint</span><span class=p>]</span><span class=w></span>
<span class=n>BindCB</span><span class=w>  </span><span class=s>"Globals"</span><span class=w> </span><span class=mo>0</span><span class=w></span>
<span class=w>      </span><span class=n>ps_4_0</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_constantbuffer</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span><span class=w> </span><span class=n>immediateIndexed</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_sampler</span><span class=w> </span><span class=n>s0</span><span class=p>,</span><span class=w> </span><span class=n>mode_default</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_resource_texture2d</span><span class=w> </span><span class=p>(</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>)</span><span class=w> </span><span class=n>t0</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_input_ps</span><span class=w> </span><span class=k>linear</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xy</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_output</span><span class=w> </span><span class=n>o0</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_temps</span><span class=w> </span><span class=mi>2</span><span class=w></span>
<span class=w>   </span><span class=mo>0</span><span class=o>:</span><span class=w> </span><span class=k>sample</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xyxx</span><span class=p>,</span><span class=w> </span><span class=n>t0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>s0</span><span class=w></span>
<span class=w>   </span><span class=mi>1</span><span class=o>:</span><span class=w> </span><span class=nb>mul</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>6</span><span class=p>].</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>2</span><span class=o>:</span><span class=w> </span><span class=nb>mul</span><span class=w> </span><span class=n>r1</span><span class=p>.</span><span class=n>xy</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xyxx</span><span class=p>,</span><span class=w> </span><span class=n>l</span><span class=p>(</span><span class=mf>10.000000</span><span class=p>,</span><span class=w> </span><span class=mf>10.000000</span><span class=p>,</span><span class=w> </span><span class=mf>0.000000</span><span class=p>,</span><span class=w> </span><span class=mf>0.000000</span><span class=p>)</span><span class=w></span>
<span class=w>   </span><span class=mi>3</span><span class=o>:</span><span class=w> </span><span class=k>sample</span><span class=w> </span><span class=n>r1</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r1</span><span class=p>.</span><span class=n>xyxx</span><span class=p>,</span><span class=w> </span><span class=n>t0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>s0</span><span class=w></span>
<span class=w>   </span><span class=mi>4</span><span class=o>:</span><span class=w> </span><span class=nb>mul</span><span class=w> </span><span class=n>o0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r1</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>5</span><span class=o>:</span><span class=w> </span><span class=n>ret</span><span class=w></span>
</code></pre></div></td></tr></table></div><h3 id=13-单独的细节纹理>1.3. 单独的细节纹理<a title="Permanent link"class=headerlink href=#13-单独的细节纹理></a></h3><p>将两个纹理相乘时，结果会更暗。除非至少其中一种纹理是白色的。这是因为像素的每个颜色通道都有一个介于 0 和 1 之间的值。当向纹理添加细节时，可以通过该通道值来实现变暗或变亮。</p><p>要使原始纹理变亮，给原始颜色乘2，使得每个颜色值都增大。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>color</span><span class=w> </span><span class=o>*=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w></span>
</code></pre></div></td></tr></table></div><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/doubled.png title=增亮颜色></p><p>这种直接扩大倍数的做法很粗暴。我们知道任何数乘以1不变，但是对细节纹理色加倍时，但对于½这个分界值就有用了。颜色区间是0-1，低于½的值将是结果变暗，高于½的值将变亮。这里引入一张特殊的灰度细节纹理来处理。 <img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/grid-detail.png title=细节灰度图></p><details class=question><summary>灰度细节纹理？</summary> <p>一般都是用灰度细节纹理来增白或加深原始颜色做二次细节调整，不是灰度图跳出的颜色不是那么直观的结果。</p></details><p>要使用这个单独的细节纹理，我们必须在着色器中添加第二个纹理属性。使用灰色作为默认值，因为这不会改变主纹理的外观。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>Properties</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>_Tint</span><span class=w> </span><span class=p>(</span><span class=s>"Tint"</span><span class=p>,</span><span class=w> </span><span class=n>Color</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w></span>
<span class=w>    </span><span class=n>_MainTex</span><span class=w> </span><span class=p>(</span><span class=s>"Texture"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=n>_DetailTex</span><span class=w> </span><span class=p>(</span><span class=s>"Detail Texture"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"gray"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>将细节纹理分配给我们的材质并将其平铺设置为10。 <img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/detail-texture-inspector.png title=两种纹理></p><p>我们必须添加变量来访问细节纹理及其平铺和偏移数据</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>sampler2D</span><span class=w> </span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>_DetailTex</span><span class=p>;</span><span class=w></span>
<span class=kt>float4</span><span class=w> </span><span class=n>_MainTex_ST</span><span class=p>,</span><span class=w> </span><span class=n>_DetailTex_ST</span><span class=p>;</span><span class=w></span>
</code></pre></div></td></tr></table></div><h3 id=14-使用两个uv>1.4. 使用两个UV<a title="Permanent link"class=headerlink href=#14-使用两个uv></a></h3><p>我们应该使用细节纹理的平铺和偏移数据，而不是使用硬编码乘10。<div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>struct</span><span class=w> </span><span class=n>Interpolators</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kt>float4</span><span class=w> </span><span class=n>position</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>SV_POSITION</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kt>float2</span><span class=w> </span><span class=n>uv</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>TEXCOORD0</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kt>float2</span><span class=w> </span><span class=n>uvDetail</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>TEXCOORD1</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>通过使用主纹理uv对细节纹理进行采样，得到一个新的细节纹理uv。<div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>Interpolators</span><span class=w> </span><span class=n>MyVertexProgram</span><span class=w> </span><span class=p>(</span><span class=n>VertexData</span><span class=w> </span><span class=n>v</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>Interpolators</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=n>i</span><span class=p>.</span><span class=n>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>mul</span><span class=p>(</span><span class=n>UNITY_MATRIX_MVP</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>position</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRANSFORM_TEX</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv</span><span class=p>,</span><span class=w> </span><span class=n>_MainTex</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=n>i</span><span class=p>.</span><span class=n>uvDetail</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRANSFORM_TEX</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv</span><span class=p>,</span><span class=w> </span><span class=n>_DetailTex</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>再一次看看汇编代码<div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>uniform</span><span class=w>     </span><span class=n>vec4</span><span class=w> </span><span class=n>_Tint</span><span class=p>;</span><span class=w></span>
<span class=k>uniform</span><span class=w>     </span><span class=n>vec4</span><span class=w> </span><span class=n>_MainTex_ST</span><span class=p>;</span><span class=w></span>
<span class=k>uniform</span><span class=w>     </span><span class=n>vec4</span><span class=w> </span><span class=n>_DetailTex_ST</span><span class=p>;</span><span class=w></span>
<span class=k>in</span><span class=w>  </span><span class=n>vec4</span><span class=w> </span><span class=n>in_POSITION0</span><span class=p>;</span><span class=w></span>
<span class=k>in</span><span class=w>  </span><span class=n>vec2</span><span class=w> </span><span class=n>in_TEXCOORD0</span><span class=p>;</span><span class=w></span>
<span class=k>out</span><span class=w> </span><span class=n>vec2</span><span class=w> </span><span class=n>vs_TEXCOORD0</span><span class=p>;</span><span class=w></span>
<span class=k>out</span><span class=w> </span><span class=n>vec2</span><span class=w> </span><span class=n>vs_TEXCOORD1</span><span class=p>;</span><span class=w></span>
<span class=n>vec4</span><span class=w> </span><span class=n>t0</span><span class=p>;</span><span class=w></span>
<span class=kt>void</span><span class=w> </span><span class=n>main</span><span class=p>()</span><span class=w></span>
<span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>t0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>in_POSITION0</span><span class=p>.</span><span class=n>yyyy</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>glstate_matrix_mvp</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span><span class=w></span>
<span class=w>    </span><span class=n>t0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>glstate_matrix_mvp</span><span class=p>[</span><span class=mo>0</span><span class=p>]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>in_POSITION0</span><span class=p>.</span><span class=n>xxxx</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>t0</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>t0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>glstate_matrix_mvp</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>in_POSITION0</span><span class=p>.</span><span class=n>zzzz</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>t0</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>gl_Position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>glstate_matrix_mvp</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>in_POSITION0</span><span class=p>.</span><span class=n>wwww</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>t0</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>vs_TEXCOORD0</span><span class=p>.</span><span class=n>xy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>in_TEXCOORD0</span><span class=p>.</span><span class=n>xy</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>xy</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>vs_TEXCOORD1</span><span class=p>.</span><span class=n>xy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>in_TEXCOORD0</span><span class=p>.</span><span class=n>xy</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_DetailTex_ST</span><span class=p>.</span><span class=n>xy</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>_DetailTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>Vector</span><span class=w> </span><span class=mi>112</span><span class=w> </span><span class=p>[</span><span class=n>_MainTex_ST</span><span class=p>]</span><span class=w></span>
<span class=n>Vector</span><span class=w> </span><span class=mi>128</span><span class=w> </span><span class=p>[</span><span class=n>_DetailTex_ST</span><span class=p>]</span><span class=w></span>
<span class=n>ConstBuffer</span><span class=w> </span><span class=s>"UnityPerDraw"</span><span class=w> </span><span class=mi>352</span><span class=w></span>
<span class=n>Matrix</span><span class=w> </span><span class=mo>0</span><span class=w> </span><span class=p>[</span><span class=n>glstate_matrix_mvp</span><span class=p>]</span><span class=w></span>
<span class=n>BindCB</span><span class=w>  </span><span class=s>"Globals"</span><span class=w> </span><span class=mo>0</span><span class=w></span>
<span class=n>BindCB</span><span class=w>  </span><span class=s>"UnityPerDraw"</span><span class=w> </span><span class=mi>1</span><span class=w></span>
<span class=w>      </span><span class=n>vs_4_0</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_constantbuffer</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span><span class=w> </span><span class=n>immediateIndexed</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_constantbuffer</span><span class=w> </span><span class=n>cb1</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span><span class=w> </span><span class=n>immediateIndexed</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_input</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_input</span><span class=w> </span><span class=n>v1</span><span class=p>.</span><span class=n>xy</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_output_siv</span><span class=w> </span><span class=n>o0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>position</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_output</span><span class=w> </span><span class=n>o1</span><span class=p>.</span><span class=n>xy</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_output</span><span class=w> </span><span class=n>o1</span><span class=p>.</span><span class=n>zw</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_temps</span><span class=w> </span><span class=mi>1</span><span class=w></span>
<span class=w>   </span><span class=mo>0</span><span class=o>:</span><span class=w> </span><span class=nb>mul</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>yyyy</span><span class=p>,</span><span class=w> </span><span class=n>cb1</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>1</span><span class=o>:</span><span class=w> </span><span class=nb>mad</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>cb1</span><span class=p>[</span><span class=mo>0</span><span class=p>].</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xxxx</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>2</span><span class=o>:</span><span class=w> </span><span class=nb>mad</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>cb1</span><span class=p>[</span><span class=mi>2</span><span class=p>].</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>zzzz</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>3</span><span class=o>:</span><span class=w> </span><span class=nb>mad</span><span class=w> </span><span class=n>o0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>cb1</span><span class=p>[</span><span class=mi>3</span><span class=p>].</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>wwww</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>4</span><span class=o>:</span><span class=w> </span><span class=nb>mad</span><span class=w> </span><span class=n>o1</span><span class=p>.</span><span class=n>xy</span><span class=p>,</span><span class=w> </span><span class=n>v1</span><span class=p>.</span><span class=n>xyxx</span><span class=p>,</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>7</span><span class=p>].</span><span class=n>xyxx</span><span class=p>,</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>7</span><span class=p>].</span><span class=n>zwzz</span><span class=w></span>
<span class=w>   </span><span class=mi>5</span><span class=o>:</span><span class=w> </span><span class=nb>mad</span><span class=w> </span><span class=n>o1</span><span class=p>.</span><span class=n>zw</span><span class=p>,</span><span class=w> </span><span class=n>v1</span><span class=p>.</span><span class=n>xxxy</span><span class=p>,</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>8</span><span class=p>].</span><span class=n>xxxy</span><span class=p>,</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>8</span><span class=p>].</span><span class=n>zzzw</span><span class=w></span>
<span class=w>   </span><span class=mi>6</span><span class=o>:</span><span class=w> </span><span class=n>ret</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>注意两个 UV 输出是如何在两个编译器顶点程序中定义的。OpenGLCore使用vs_TEXCOORD0和vs_TEXCOORD1输出，相反Direct3D11只使用一个输出o1.</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=c1>// Output signature:</span><span class=w></span>
<span class=c1>//</span><span class=w></span>
<span class=c1>// Name                 Index   Mask Register SysValue  Format   Used</span><span class=w></span>
<span class=c1>// -- --  -- -- - </span><span class=w></span>
<span class=c1>// SV_POSITION              0   xyzw        0      POS   float   xyzw</span><span class=w></span>
<span class=c1>// TEXCOORD                 0   xy          1     NONE   float   xy  </span><span class=w></span>
<span class=c1>// TEXCOORD                 1     zw        1     NONE   float     zw</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>上面代码意味着两个 UV 对都被打包到一个输出寄存器中。第一个在 X 和 Y 通道，第二个在 Z 和 W 通道。因为寄存器总是由四个数字组成的组。Direct3D 11 编译器利用了这一点。</p><details class=tip open><summary>试着手动打包输出?</summary> <p>手动打包输出的常见原因是只有少数几个插值器可用。Shader Model 2硬件支持8个通用插值器，而Shader Model 3硬件支持10个。复杂着色器可能会遇到这个限制。</p></details><p>现在我们可以在片段程序中使用额外的UV对。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kt>float4</span><span class=w> </span><span class=n>MyFragmentProgram</span><span class=w> </span><span class=p>(</span><span class=n>Interpolators</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>SV_TARGET</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kt>float4</span><span class=w> </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_Tint</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>*=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_DetailTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uvDetail</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>color</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>uniform</span><span class=w>     </span><span class=n>vec4</span><span class=w> </span><span class=n>_Tint</span><span class=p>;</span><span class=w></span>
<span class=k>uniform</span><span class=w>     </span><span class=n>vec4</span><span class=w> </span><span class=n>_MainTex_ST</span><span class=p>;</span><span class=w></span>
<span class=k>uniform</span><span class=w>     </span><span class=n>vec4</span><span class=w> </span><span class=n>_DetailTex_ST</span><span class=p>;</span><span class=w></span>
<span class=k>uniform</span><span class=w>  </span><span class=n>sampler2D</span><span class=w> </span><span class=n>_MainTex</span><span class=p>;</span><span class=w></span>
<span class=k>uniform</span><span class=w>  </span><span class=n>sampler2D</span><span class=w> </span><span class=n>_DetailTex</span><span class=p>;</span><span class=w></span>
<span class=k>in</span><span class=w>  </span><span class=n>vec2</span><span class=w> </span><span class=n>vs_TEXCOORD0</span><span class=p>;</span><span class=w></span>
<span class=k>in</span><span class=w>  </span><span class=n>vec2</span><span class=w> </span><span class=n>vs_TEXCOORD1</span><span class=p>;</span><span class=w></span>
<span class=n>layout</span><span class=p>(</span><span class=n>location</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mo>0</span><span class=p>)</span><span class=w> </span><span class=k>out</span><span class=w> </span><span class=n>vec4</span><span class=w> </span><span class=n>SV_TARGET0</span><span class=p>;</span><span class=w></span>
<span class=n>vec4</span><span class=w> </span><span class=n>t0</span><span class=p>;</span><span class=w></span>
<span class=n>lowp</span><span class=w> </span><span class=n>vec4</span><span class=w> </span><span class=n>t10_0</span><span class=p>;</span><span class=w></span>
<span class=n>lowp</span><span class=w> </span><span class=n>vec4</span><span class=w> </span><span class=n>t10_1</span><span class=p>;</span><span class=w></span>
<span class=kt>void</span><span class=w> </span><span class=n>main</span><span class=p>()</span><span class=w></span>
<span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>t10_0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>texture</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>vs_TEXCOORD0</span><span class=p>.</span><span class=n>xy</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>t0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t10_0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_Tint</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>t10_1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>texture</span><span class=p>(</span><span class=n>_DetailTex</span><span class=p>,</span><span class=w> </span><span class=n>vs_TEXCOORD1</span><span class=p>.</span><span class=n>xy</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>t0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>t10_1</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>SV_TARGET0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>t0</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>SetTexture</span><span class=w> </span><span class=mo>0</span><span class=w> </span><span class=p>[</span><span class=n>_MainTex</span><span class=p>]</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=w> </span><span class=mo>0</span><span class=w></span>
<span class=n>SetTexture</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>[</span><span class=n>_DetailTex</span><span class=p>]</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=w> </span><span class=mi>1</span><span class=w></span>
<span class=n>ConstBuffer</span><span class=w> </span><span class=s>"Globals"</span><span class=w> </span><span class=mi>144</span><span class=w></span>
<span class=n>Vector</span><span class=w> </span><span class=mi>96</span><span class=w> </span><span class=p>[</span><span class=n>_Tint</span><span class=p>]</span><span class=w></span>
<span class=n>BindCB</span><span class=w>  </span><span class=s>"Globals"</span><span class=w> </span><span class=mo>0</span><span class=w></span>
<span class=w>      </span><span class=n>ps_4_0</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_constantbuffer</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span><span class=w> </span><span class=n>immediateIndexed</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_sampler</span><span class=w> </span><span class=n>s0</span><span class=p>,</span><span class=w> </span><span class=n>mode_default</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_sampler</span><span class=w> </span><span class=n>s1</span><span class=p>,</span><span class=w> </span><span class=n>mode_default</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_resource_texture2d</span><span class=w> </span><span class=p>(</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>)</span><span class=w> </span><span class=n>t0</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_resource_texture2d</span><span class=w> </span><span class=p>(</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>,</span><span class=kt>float</span><span class=p>)</span><span class=w> </span><span class=n>t1</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_input_ps</span><span class=w> </span><span class=k>linear</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xy</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_input_ps</span><span class=w> </span><span class=k>linear</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>zw</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_output</span><span class=w> </span><span class=n>o0</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>      </span><span class=n>dcl_temps</span><span class=w> </span><span class=mi>2</span><span class=w></span>
<span class=w>   </span><span class=mo>0</span><span class=o>:</span><span class=w> </span><span class=k>sample</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>xyxx</span><span class=p>,</span><span class=w> </span><span class=n>t0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>s0</span><span class=w></span>
<span class=w>   </span><span class=mi>1</span><span class=o>:</span><span class=w> </span><span class=nb>mul</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>cb0</span><span class=p>[</span><span class=mi>6</span><span class=p>].</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>2</span><span class=o>:</span><span class=w> </span><span class=k>sample</span><span class=w> </span><span class=n>r1</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>.</span><span class=n>zwzz</span><span class=p>,</span><span class=w> </span><span class=n>t1</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>s1</span><span class=w></span>
<span class=w>   </span><span class=mi>3</span><span class=o>:</span><span class=w> </span><span class=nb>mul</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r1</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>4</span><span class=o>:</span><span class=w> </span><span class=n>add</span><span class=w> </span><span class=n>o0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=p>,</span><span class=w> </span><span class=n>r0</span><span class=p>.</span><span class=n>xyzw</span><span class=w></span>
<span class=w>   </span><span class=mi>5</span><span class=o>:</span><span class=w> </span><span class=n>ret</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>基于细节纹理，主纹理变得更亮和更暗。 <img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/grid-with-detail.png title=纹理叠加></p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/grid-close-up-detail.png title=叠加细节></p><h3 id=15-细节纹理渐变融合>1.5. 细节纹理渐变融合<a title="Permanent link"class=headerlink href=#15-细节纹理渐变融合></a></h3><p>添加细节的想法是它们可以在近距离或放大时改善材质的外观。它们不应该在远处可见或缩小，因为这会使平铺变得明显。所以我们需要一种方法来随着纹理显示尺寸的减小而淡化细节。我们可以通过将细节纹理淡化为灰色来做到这一点，因为这不会导致颜色变化。</p><p>需要做的就是在细节纹理的导入设置中启用Fadeout Mip Maps属性。这也会自动将过滤器模式切换为三线性，以便渐变为灰色是渐进的。 <img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/fading-inspector.png title=fading面板设置></p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/grid-fading-detail.png title=纹理过渡></p><p>网格从详细到不详细的过渡非常明显，但通常不会注意到它。例如，这里是大理石材质的主纹理和细节纹理。 <img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/marble.png title=大理石纹理></p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/marble-detail.png title=大理石细节纹理></p><p>一旦我们的材质使用了这些纹理，细节纹理的过渡痕迹就不再明显了。</p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/marble-inspector.png title=面板设置></p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/marble-scene.png title=大理石材质></p><p>然而，由于细节纹理的过渡加持，大理石材质在近距离看起来要好得多。 <img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/marble-close.png title=没有细节></p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/marble-close-detail.png title=有细节特写></p><h3 id=16-线性色彩空间>1.6. 线性色彩空间<a title="Permanent link"class=headerlink href=#16-线性色彩空间></a></h3><p>当我们在 gamma 颜色空间中渲染场景时，我们的着色器工作正常，但如果我们切换到线性颜色空间，它就会出错。色彩空间在项目中设置。它配置在Other Settings播放器设置面板，可以通过Edit / Project Settings / Player. <img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/color-space-inspector.png title=选择颜色空间></p><h3 id=17-什么是gamma色彩空间>1.7. 什么是gamma色彩空间?<a title="Permanent link"class=headerlink href=#17-什么是gamma色彩空间></a></h3><p>伽玛空间是指经过伽玛校正的色彩空间。伽玛校正是对光强度的调整。最简单的方法是将原始值提高到某个幂次，即<span class=arithmatex>\(value^{gamma}\)</span>。gamma为1表示没有变化，随着gamma递增光强度递增。</p><p>这种转换最初是为了适应CRT显示器的非线性特性而引入的。另一个好处是它也大致对应于我们的眼睛对不同光强度的敏感程度。我们注意到深色之间的差异比明亮颜色之间的差异更大。因此，将更多的数字位分配给较暗的值而不是较浅的值是有意义的。求幂运算允许将较低的值扩展到更大的范围，同时压缩较高的值。</p><p>最广泛使用的图像颜色格式是sRGB。它使用比简单求幂更复杂的公式，sRGB以<span class=arithmatex>\(1\over 2.2\)</span>的平均gamma值存储颜色，正常情况下这是一个合理的近似值。要将此数据转换回其原始颜色，请2.2幂的伽马校正。</p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/linear-to-gamma.png title=gamma(1/2.2)encoding></p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/gamma-to-linear.png title=(2.2)deconding></p><p>假设Unity纹理的颜色存储为sRGB。在伽马空间中渲染时，着色器直接访问原始颜色和纹理数据。这是我们到目前为止所假设的。</p><p>但是在线性空间中渲染时，就不再适用。 GPU会将采样的纹理颜色转换为线性空间。此外，Unity 也会将材质颜色属性转换为线性空间。然后着色器使用这些线性颜色进行操作。之后，片段程序的输出将被转换回伽马空间。</p><p>使用线性颜色的优点之一是它可以实现更逼真的照明计算。这是因为光的相互作用在现实生活中是线性的，而不是指数的。不幸的是，切换到线性空间后，细节材料变得更暗。为什么会这样？</p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/gamma-space.png title=gamma色彩空间></p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/linear-space.png title=linear色彩空间></p><p>因为我们将细节纹理采样后的颜色乘了2，所以<span class=arithmatex>\(1\over 2\)</span>的值不会导致主纹理发生任何变化。但是，转换为线性空间后，它会变为接近<span class=arithmatex>\({1\over 2} ^{2.2} \approx 0.22\)</span>。加倍大约是0.44，远小于 1。这就解释了为什么变得更暗。</p><p>我们可以通过在细节纹理的导入设置中启用<em>Bypass sRGB Sampling</em>来解决这个错误。这可以防止从伽玛到线性空间的转换，因此着色器将始终访问原始图像数据。但是，细节纹理是sRGB图像，所以结果仍然是错误的。</p><p>最好的解决方案是重新对齐细节颜色，使它们再次以 1 为中心。我们可以通过<span class=arithmatex>\({1 \over {1\over 2} ^{2.2}} \approx 4.59\)</span>而不是乘以2来做到这一点。但我们只能在线性空间中渲染时才这样计算。</p><p><em>UnityCG.cginc</em>定义了一个统一变量，它将包含要与之相乘的正确数字。它是一个 <code>float4</code>，它的 rgb 分量有2或约4.59，这两个值视情况而定。由于伽马校正未应用于Alpha通道，因此始终为2。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>color</span><span class=w> </span><span class=o>*=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_DetailTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uvDetail</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>unity_ColorSpaceDouble</span><span class=p>;</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>通过这种更改，无论我们在哪个颜色空间中渲染，我们的细节材质看起来都一样。</p><h2 id=2-纹理splat过渡遮罩>2. 纹理splat过渡遮罩<a title="Permanent link"class=headerlink href=#2-纹理splat过渡遮罩></a></h2><p>细节纹理的一个限制是对整个表面使用相同的细节。 这适用于均匀的表面，如大理石板。但是，如果材质没有统一的外观，不希望在任何地方都使用相同的细节。</p><p>考虑一个大地形。它可以有草、沙、岩石、雪等。希望这些地形类型有一定的细节。但是覆盖整个地形的纹理永远不会有足够的细节。可以通过为每种表面类型使用单独的纹理并平铺这些纹理来解决该问题。但是怎么知道在哪里使用哪种纹理呢？</p><p>假设我们有一个具有两种不同表面类型的地形，什么时候决定使用哪种表面纹理呢。不是一就是二。我们可以用一个布尔值来表示这个逻辑。如果设置为true，我们使用第一个纹理，否则使用第二个。我们可以使用灰度纹理来存储这个选择。值1表示第一个纹理，而值0表示第二个纹理。事实上，我们可以使用这些值在两个纹理之间进行线性插值。然后介于 0 和 1 之间的值表示两种纹理之间的混合，这使得平滑过渡成为可能。</p><p>这样的纹理被称为splat贴图。就像将多个地形特征喷溅到画布上一样。由于插值，这张地图甚至不需要高分辨率。</p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/binary-splat-map.png title=splat遮罩贴图></p><p>将其添加到项目后，将其导入类型切换为高级。启用Bypass sRGB Sampling并指示其mipmap应在Linear Space中生成。因为该纹理不需要sRGB颜色。所以在线性空间中渲染时不应该进行转换。另外，将其 Wrap Mode 设置为clamp，因为我们不会平铺这张地图。</p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/splat-map-binary-import.png title=splat导入设置></p><p>创建一个新的 Texture Splatting)着色器。<div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>Shader</span><span class=w> </span><span class=s>"Custom/Texture Splatting"</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>Properties</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>MainTex</span><span class=w> </span><span class=p>(</span><span class=s>"Splat Map"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>

<span class=w>    </span><span class=n>SubShader</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>Pass</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>CGPROGRAM</span><span class=w></span>

<span class=w>        </span><span class=err>#</span><span class=n>pragma</span><span class=w> </span><span class=n>vertex</span><span class=w> </span><span class=n>MyVertexProgram</span><span class=w></span>
<span class=w>        </span><span class=err>#</span><span class=n>pragma</span><span class=w> </span><span class=n>fragment</span><span class=w> </span><span class=n>MyFragmentProgram</span><span class=w></span>

<span class=w>        </span><span class=err>#</span><span class=n>include</span><span class=w> </span><span class=s>"UnityCG.cginc"</span><span class=w></span>

<span class=w>        </span><span class=n>sampler2D</span><span class=w> </span><span class=n>_MainTex</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=kt>float4</span><span class=w> </span><span class=n>_MainTex_ST</span><span class=p>;</span><span class=w></span>

<span class=w>        </span><span class=k>struct</span><span class=w> </span><span class=n>VertexData</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=kt>float4</span><span class=w> </span><span class=n>position</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>POSITION</span><span class=p>;</span><span class=w></span>
<span class=w>            </span><span class=kt>float2</span><span class=w> </span><span class=n>uv</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>TEXCOORD0</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>

<span class=w>        </span><span class=k>struct</span><span class=w> </span><span class=n>Interpolators</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=kt>float4</span><span class=w> </span><span class=n>position</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>SV_POSITION</span><span class=p>;</span><span class=w></span>
<span class=w>            </span><span class=kt>float2</span><span class=w> </span><span class=n>uv</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>TEXCOORD0</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>

<span class=w>        </span><span class=n>Interpolators</span><span class=w> </span><span class=n>MyVertexProgram</span><span class=w> </span><span class=p>(</span><span class=n>VertexData</span><span class=w> </span><span class=n>v</span><span class=p>)</span><span class=w></span>
<span class=w>        </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=n>Interpolators</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w></span>
<span class=w>            </span><span class=n>i</span><span class=p>.</span><span class=n>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>mul</span><span class=p>(</span><span class=n>UNITY_MATRIX_MVP</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>position</span><span class=p>);</span><span class=w></span>
<span class=w>            </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRANSFORM_TEX</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv</span><span class=p>,</span><span class=w> </span><span class=n>_MainTex</span><span class=p>);</span><span class=w></span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>

<span class=w>        </span><span class=kt>float4</span><span class=w> </span><span class=n>MyFragmentProgram</span><span class=w> </span><span class=p>(</span><span class=n>Interpolators</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>SV_TARGET</span><span class=w></span>
<span class=w>        </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>

<span class=w>        </span><span class=n>ENDCG</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>创建一个新材质并引用该shader，并将splat贴图指定为其主要纹理。</p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/splat-map-binary-inspector.png title=面板设置></p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/splat-map-binary-scene.png title=splat图渲染></p><h3 id=21-增加融合纹理>2.1. 增加融合纹理<a title="Permanent link"class=headerlink href=#21-增加融合纹理></a></h3><p>为了能够在两个纹理之间进行选择，作为属性添加命名为Texture1和Texture2到我们的着色器中。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>Properties</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>_MainTex</span><span class=w> </span><span class=p>(</span><span class=s>"Splat Map"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=n>_Texture1</span><span class=w> </span><span class=p>(</span><span class=s>"Texture 1"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=n>_Texture2</span><span class=w> </span><span class=p>(</span><span class=s>"Texture 2"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>可以为他们使用任何你想要的纹理,这里使用网格纹理和大理石纹理。</p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/two-textures-inspector.png title=增加的额外纹理></p><p>为添加到着色器的每个纹理修改平铺和偏移控制值。这需要我们将更多数据从顶点传递到片段着色器，或者在片元着色器中计算UV调整。 这很好，但通常地形的所有纹理都平铺相同。并且 splat 地图根本没有平铺。所以我们只需要一个平铺和偏移控件的实例。</p><p>可以将属性控制添加到着色器属性之前，就像在C#代码中一样。<code>NoScaleOffset</code>将禁用纹理平铺和偏移。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>Properties</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>_MainTex</span><span class=w> </span><span class=p>(</span><span class=s>"Splat Map"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=p>[</span><span class=n>NoScaleOffset</span><span class=p>]</span><span class=w> </span><span class=n>_Texture1</span><span class=w> </span><span class=p>(</span><span class=s>"Texture 1"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=p>[</span><span class=n>NoScaleOffset</span><span class=p>]</span><span class=w> </span><span class=n>_Texture2</span><span class=w> </span><span class=p>(</span><span class=s>"Texture 2"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>同时修改splat贴图tiling为4。</p><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/no-tiling-offset.png title=不需要额外的贴图纹理></p><p>将采样器变量添加到我们的着色器代码中，但是不必添加它们对应的 _ST 变量。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>sampler2D</span><span class=w> </span><span class=n>_MainTex</span><span class=p>;</span><span class=w></span>
<span class=kt>float4</span><span class=w> </span><span class=n>_MainTex_ST</span><span class=p>;</span><span class=w></span>

<span class=n>sampler2D</span><span class=w> </span><span class=n>_Texture1</span><span class=p>,</span><span class=w> </span><span class=n>_Texture2</span><span class=p>;</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>对两张纹理采样后叠加，颜色会得到加深，然后输出</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kt>float4</span><span class=w> </span><span class=n>MyFragmentProgram</span><span class=w> </span><span class=p>(</span><span class=n>Interpolators</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>SV_TARGET</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture1</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture2</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/textures-added.png title=纹理叠加></p><h3 id=22-使用splat贴图>2.2. 使用splat贴图<a title="Permanent link"class=headerlink href=#22-使用splat贴图></a></h3><p>采样splat纹理需要顶点程序提供的UV坐标</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>struct</span><span class=w> </span><span class=n>Interpolators</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kt>float4</span><span class=w> </span><span class=n>position</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>SV_POSITION</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=kt>float2</span><span class=w> </span><span class=n>uv</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>TEXCOORD0</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=kt>float2</span><span class=w> </span><span class=n>uvSplat</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>TEXCOORD1</span><span class=p>;</span><span class=w></span>
<span class=p>};</span><span class=w></span>

<span class=n>Interpolators</span><span class=w> </span><span class=n>MyVertexProgram</span><span class=w> </span><span class=p>(</span><span class=n>VertexData</span><span class=w> </span><span class=n>v</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>Interpolators</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>i</span><span class=p>.</span><span class=n>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>mul</span><span class=p>(</span><span class=n>UNITY_MATRIX_MVP</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>position</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRANSFORM_TEX</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv</span><span class=p>,</span><span class=w> </span><span class=n>_MainTex</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>i</span><span class=p>.</span><span class=n>uvSplat</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>uv</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>然后，以在对其他纹理进行采样之前对splat贴图进行采样。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kt>float4</span><span class=w> </span><span class=n>MyFragmentProgram</span><span class=w> </span><span class=p>(</span><span class=n>Interpolators</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>SV_TARGET</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kt>float4</span><span class=w> </span><span class=n>splat</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uvSplat</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w></span>
<span class=w>    </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture1</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w></span>
<span class=w>    </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture2</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>因为splat本身是单通道，可以任选一个RGB通道来来存储值，这里先决定使用第一个纹理与splat贴图R通道相乘。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>return</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture1</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>splat</span><span class=p>.</span><span class=n>r</span><span class=w> </span><span class=o>+</span><span class=w></span>
<span class=w>       </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture2</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span><span class=w></span>
</code></pre></div></td></tr></table></div><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/modulating-first-texture.png title=调制第一个纹理></p><p>第一个纹理现在由splat贴图R通道调制。为了完成插值，我们必须将另一个纹理<code>1-R</code>相乘。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>return</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture1</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>splat</span><span class=p>.</span><span class=n>r</span><span class=w> </span><span class=o>+</span><span class=w></span>
<span class=w>       </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture2</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>splat</span><span class=p>.</span><span class=n>r</span><span class=p>);</span><span class=w></span>
</code></pre></div></td></tr></table></div><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/modulating-both-textures.png title=调制两个纹理></p><h3 id=23-rgb-splat贴图>2.3. RGB Splat贴图<a title="Permanent link"class=headerlink href=#23-rgb-splat贴图></a></h3><p>我们有一个功能性的splat材质，但它只支持两种纹理。我们可以支持更多吗？我们现在只使用了R通道，那么我们添加G和B通道怎么样？那么(1,0,0)代表第一个纹理，(0,1,0)代表第二个纹理，(0,0,1)代表第三个纹理。 为了在这三个之间获得正确的插值，我们只需要确保RGB通道的总和为1即可。</p><p>但是等等，当我们只使用一个通道时，我们可以支持两个纹理。这是因为第二个纹理的权重是通过<code>1-R</code>得出的。同样的技巧适用于任意数量的通道。因此可以通过<code>1-R-G-B</code>支持另一种纹理。</p><p>这导致了一个具有三种颜色和黑色的splat贴图。只要三个通道加起来不超过1，它就是一个有效的贴图。这里给出一张这样的贴图，导入Unity。</p><p><img title="RGB splat 贴图"alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/rgb-splat-map.png></p><details class=question><summary>当 R + G + B 超过1时会发生什么？</summary> <p>那么前三个纹理的组合会太强。 同时，第四个纹理将被减去而不是被添加。 如果错误很小，那么不会注意到并且结果足够好。 示例 RGB 映射实际上并不完美，但不会注意到。 纹理压缩引入后更错误了，但同样难以察觉。</p> <p>可以使用alpha通道吗？</p> <p>确实可以！ 这意味着单个 RGBA splat 贴图最多可以支持五种不同的地形类型。 但是对于本教程，四个就足够了。 如果要使用超过五个纹理，则必须使用多个splat贴图。虽然这是可能的，但最终会得到很多纹理采样。此时可以使用更好的技术，例如纹理数组。</p></details><p>为了支持 RGB splat贴图，我们必须在着色器中添加两个额外的纹理。为它们分配了大理石细节和测试纹理。<div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>Properties</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>_MainTex</span><span class=w> </span><span class=p>(</span><span class=s>"Splat Map"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=p>[</span><span class=n>NoScaleOffset</span><span class=p>]</span><span class=w> </span><span class=n>_Texture1</span><span class=w> </span><span class=p>(</span><span class=s>"Texture 1"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=p>[</span><span class=n>NoScaleOffset</span><span class=p>]</span><span class=w> </span><span class=n>_Texture2</span><span class=w> </span><span class=p>(</span><span class=s>"Texture 2"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=p>[</span><span class=n>NoScaleOffset</span><span class=p>]</span><span class=w> </span><span class=n>_Texture3</span><span class=w> </span><span class=p>(</span><span class=s>"Texture 3"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=w>    </span><span class=p>[</span><span class=n>NoScaleOffset</span><span class=p>]</span><span class=w> </span><span class=n>_Texture4</span><span class=w> </span><span class=p>(</span><span class=s>"Texture 4"</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=n>D</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"white"</span><span class=w> </span><span class=p>{}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></table></div><p><img title="Four textures"alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/splat-map-rgb-inspector.png></p><p>将所需的变量添加到着色器。 再一次，没有额外的 _ST需要的变量。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>sampler2D</span><span class=w> </span><span class=n>_Texture1</span><span class=p>,</span><span class=w> </span><span class=n>_Texture2</span><span class=p>,</span><span class=w> </span><span class=n>_Texture3</span><span class=p>,</span><span class=w> </span><span class=n>_Texture4</span><span class=p>;</span><span class=w></span>
</code></pre></div></td></tr></table></div><p>在片段程序中，添加额外的纹理样本。第二个样本现在使用G通道，第三个使用B通道。最终样本用 (1 - R - g)- B) 调制。</p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=n>retur1n</span><span class=w> </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture1</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>splat</span><span class=p>.</span><span class=n>r</span><span class=w> </span><span class=o>+</span><span class=w></span>
<span class=w>        </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture2</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>splat</span><span class=p>.</span><span class=n>g</span><span class=p>)</span><span class=o>+</span><span class=w></span>
<span class=w>        </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture3</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>splat</span><span class=p>.</span><span class=n>b</span><span class=w> </span><span class=o>+</span><span class=w></span>
<span class=w>        </span><span class=nb>tex2D</span><span class=p>(</span><span class=n>_Texture4</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>splat</span><span class=p>.</span><span class=n>r</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>splat</span><span class=p>.</span><span class=n>g</span><span class=p>)</span><span class=o>-</span><span class=w> </span><span class=n>splat</span><span class=p>.</span><span class=n>b</span><span class=p>);</span><span class=w></span>
</code></pre></div></td></tr></table></div><p><img alt src=https://damonc-top2.github.io/web-assets/posts/2018/month1/catRender3/four-textures-splatted.png title=四个纹理融合></p><p>为什么混合区域在线性色彩空间中看起来不同？</p><p>我们的 splat 贴图绕过了 sRGB 采样，所以混合不应该取决于我们使用的颜色空间，对吧？ splat 地图 确实不受影响。 但是发生混合的色彩空间确实发生了变化。</p><details class=tip open><summary>Tip</summary> <p>在伽马空间渲染的情况下，样本在伽马空间中混合，仅此而已。 但是在线性空间中渲染时，它们首先转换为线性空间，然后混合，然后再转换回伽马空间。 结果略有不同。 在线性空间中，混合也是线性的。 但在伽马空间中，混合偏向较深的颜色。</p></details><p>现在知道如何应用细节纹理以及如何将多个纹理与splat贴图混合。也可以组合这些方法。</p><p>可以将四个细节纹理添加到splat着色器并使用贴图在它们之间进行混合。当然，这需要四个额外的纹理采样，性能有限。</p><p>还可以使用贴图来控制应用细节纹理的位置以及省略的位置。在这种情况下，需要一张单色贴图，它可以用作遮罩。当单个纹理同时包含表示多个不同材质的区域但没有地形那么大的面积时，这很有用。例如，如果我们的大理石纹理还包含金属片，则不希望在此处应用大理石细节。</p><h2 id=3-结尾>3. 结尾<a title="Permanent link"class=headerlink href=#3-结尾></a></h2><p>该篇内容的<a href=https://github.com/damonc-top/UnityRender/blob/master/UnityRender/Assets/2Fundamentals3Texture>完整代码</a>，该篇内容的<a href=https://catlikecoding.com/unity/tutorials/rendering/part-3/>原文出处</a>，该篇文章的<a href=https://www.damonc.top/posts/unity3d/shader/translater/catlikecoding/unity_combine_texture>原始地址</a>。</p><hr><blockquote class=page-copyright><span><i class=md-icon><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="m22.7 19-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4Z"/></svg></i>本页面最近更新：</span><span class=facts_modified></span>，<a class=edit_history>更新历史</a><br><span><i class=md-icon><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg></i>发现错误？ <a class=page_edit_url href=https://github.com/damonc-top/damonc-top.github.io/discussions/posts/unity3d/shader/translater/catlikecoding/unity_combine_texture.md title=编辑此页>在 GitHub 评论指正！</a></span><br><span><i class=md-icon><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M16 17v2H2v-2s0-4 7-4 7 4 7 4m-3.5-9.5A3.5 3.5 0 1 0 9 11a3.5 3.5 0 0 0 3.5-3.5m3.44 5.5A5.32 5.32 0 0 1 18 17v2h4v-2s0-3.63-6.06-4M15 4a3.39 3.39 0 0 0-1.93.59 5 5 0 0 1 0 5.82A3.39 3.39 0 0 0 15 11a3.5 3.5 0 0 0 0-7Z"/></svg></i>本文作者：</span><span class=page_contributors>银河揽月</span><br><span><i class=md-icon><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M10.08 10.86c.05-.33.16-.62.3-.86.3-.56.81-.85 1.5-.86.45 0 .86.2 1.15.49.28.31.47.74.47 1.17h1.8c-.02-.47-.11-.9-.3-1.3-.15-.38-.38-.72-.68-1-1.45-1.34-4.14-1.15-5.37.37-1.29 1.67-1.32 4.59-.01 6.26 1.21 1.49 3.86 1.7 5.3.37.31-.25.56-.56.76-.92.16-.36.27-.74.28-1.15H13.5c0 .21-.07.4-.16.57-.09.19-.21.34-.34.47-.33.26-.72.4-1.14.4-.36-.01-.66-.08-.89-.23a1.41 1.41 0 0 1-.59-.64c-.5-.9-.42-2.15-.3-3.14M12 2C6.5 2 2 6.5 2 12c.53 13.27 19.5 13.26 20 0 0-5.5-4.5-10-10-10m0 18c-4.41 0-8-3.59-8-8 .44-10.61 15.56-10.61 16 0 0 4.41-3.59 8-8 8Z"/></svg></i>本页面的全部内容在 <strong><a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh>CC BY-SA 4.0</a> 和 <a href=https://github.com/zTrix/sata-license>SATA</a></strong> 协议之条款下提供，附加条款亦可能应用</span></blockquote><div class=giscus data-no-instant id=__comments></div><div id=__comments_script></div><script>var comments=document.createElement("script"),commentsTheme="slate"===document.body.dataset.mdColorScheme?"dark":"light";Object.entries({async:!0,src:"https://giscus.app/client.js",crossOrigin:"anonymous","data-repo":"damonc-top/damonc-top.github.io","data-repo-id":"R_kgDOHK_iGQ","data-category":"评论","data-category-id":"DIC_kwDOHK_iGc4COonC","data-mapping":"specific","data-term":"三UnityShader纹理融合","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":commentsTheme,"data-lang":"zh-CN","data-loading":"lazy"}).forEach(t=>comments.setAttribute(t[0],t[1])),document.getElementById("__comments_script").replaceWith(comments)</script></article></div></div></main><script>function scrollFunction(){20<document.body.scrollTop||20<document.documentElement.scrollTop?document.getElementById("myBtn").style.display="block":document.getElementById("myBtn").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}window.onscroll=function(){scrollFunction()}</script><button class=data-tip-left data-tip=回到顶部 id=myBtn onclick=topFunction()><svg class="Zi Zi--BackToTop data-tip-left"viewbox="0 0 24 24"data-tip=回到顶部 fill=currentColor height=24 width=24><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"></path></svg></button><footer class=md-footer><nav class="md-footer__inner md-grid"aria-label=页脚><a aria-label="上一页: 二UnityShader基本语法"class="md-footer__link md-footer__link--prev"href=../unity_shader_fundamentals/ rel=prev> <div class="md-footer__button md-icon"><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg></div> <div class=md-footer__title><div class=md-ellipsis><span class=md-footer__direction> 上一页 </span> 二UnityShader基本语法</div></div> </a><a aria-label="下一页: 四UnityShader基础光照"class="md-footer__link md-footer__link--next"href=../unity_base_light/ rel=next> <div class=md-footer__title><div class=md-ellipsis><span class=md-footer__direction> 下一页 </span> 四UnityShader基础光照</div></div> <div class="md-footer__button md-icon"><svg viewbox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></div> </a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright><div class=md-copyright__highlight>Copyright © 2016 - 2024 银河揽月</div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs <div id=miitbeian></div> </a></div><div class=build_date_utc style=float:right><a href=https://github.com/damonc-top/damonc-top.github.io> 最近更新：6c2a14f, 2024-09-24 </a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><script id=__config type=application/json>{"base": "../../../../../..", "features": ["navigation.tabs", "navigation.instant"], "search": "../../../../../../assets/javascripts/workers/search.8e7a41fd.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script><script src=../../../../../../assets/javascripts/bundle.c15c428f.min.js></script><script src=../../../../../../extension/js/math-csr.js?math-csr></script><script src=../../../../../../assets/vendor/mathjax/es5/tex-mml-chtml.js?math-csr></script><script>"use strict";"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(function(e){console.log("PWA Registration succeeded. Scope is "+e.scope)}).catch(function(e){console.log("PWA Registration failed with "+e)})</script></body></html>