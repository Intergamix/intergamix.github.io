<!DOCTYPE html><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>About</title><meta name="description" content=""><link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon"><link rel="icon" href="/favicon.ico?" type="image/x-icon"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css"><link rel="stylesheet" href="/css/main.css "><link rel="canonical" href="www.damonc.top/about/"><link rel="alternate" type="application/rss+xml" title="bitfeng" href="www.damonc.top/feed.xml "> <script src=" /js/Valine.min.js " charset="utf-8"></script> <script src="https://code.jquery.com/jquery-3.2.0.min.js" charset="utf-8"></script> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "//hm.baidu.com/hm.js?f7f1a5967e3927ea98597632f0a17ad9"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script><body class="custom-background"><header id="top"><div class="wrapper"> <a href="/" class="brand">bitfeng</a> <small>maybe useless, but interesting.</small> <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button><nav id="headerNav"><ul><li> <a href="/"> <i class="fa fa-home"></i>Home </a><li> <a href="/archive/"> <i class="fa fa-archive"></i>Archives </a><li> <a href="/category/"> <i class="fa fa-th-list"></i>Categories </a><li> <a href="/tag/"> <i class="fa fa-tags"></i>Tags </a><li> <a href="/collection/"> <i class="fa fa-bookmark"></i>Collections </a><li> <a href="/demo/"> <i class="fa fa-play"></i>Demos </a><li> <a class="active" href="/about/"> <i class="fa fa-heart"></i>About </a></ul></nav></div></header><div class="page clearfix" post><div class="left"><h1>About</h1><hr><p>喜欢呐</p><h2 id="联系我">联系我</h2><ul><li>GitHub：<a href="https://github.com/bitfeng">bitfeng</a><li>email：damonc@126.com<li><a href="http://weibo.com">Weibo</a><li><a href="https://www.zhihu.com">知乎</a><li><a href="https://www.facebook.com">Facebook</a></ul><h2 id="comments">Comments</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div id="vcomments"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt;
/*评论相关*/
function delayLoadValine() {
    new Valine({
        el: '#vcomments',
        verify: "true",
        notify: "false",
        app_id: "iFsuyoBJtS1e8JoXLP57a3Iv-gzGzoHsz",
        app_key: "XVDIfwQXJJnDp0tDE0pOww2i",
        avatar: "monsterid",
        placeholder: "欢迎评论！",
        pageSize: "10 || 10",
        master: "b5586e582cb181c6b0fc8b2ce828bd50",
        tagMeta: ["博主","小伙伴","访客"],
        enableQQ: true,
        requiredFields: [],
        serverURLs: "",
    });

    $(document).ready(function(){
        fetch('https://v1.hitokoto.cn')
            .then(response =&gt; response.json())
            .then(data =&gt; {
                document.getElementById("veditor").setAttribute(
                    "placeholder",
                    data.hitokoto+"—"+data.from
                );

                setTimeout(() =&gt; {
                    addPostVisitedTimes();
                    getVisitorIpAndJudge();
                }, 1000);
            }
        )
        .catch(console.error);
    });
}

/*点赞相关*/
var curIpVisitRecord = null;
var curPost = null;
var curUrl = "www.damonc.top/about/";

function getVisitorIpAndJudge() {
    $.getJSON('https://api.ipify.org?format=json', function(data){
        saveOrUpdateIpRecord(data.ip)
    });
}

function saveOrUpdateIpRecord(ip) {
    if(AV == null || typeof AV =="undefined"){
        return
    }
    var Visitor = AV.Object.extend("visitors_record");
    var post_url = curUrl;
    var query = new AV.Query(Visitor);
    query.equalTo("visitor_ip", ip);
    query.equalTo("post_url", post_url);
    query.find().then(function(results) {
        if (results.length &gt; 0) {
            /*
            if(window.console){
                console.log('该IP已访问过该文章');
            }*/

            curIpVisitRecord = results[0];
            updateIpRecord();
            refreshLikeBtn();
        } else {
            /*if(window.console){
                console.log('该IP第一次访问该文章，保存新的访问记录，并增加访问次数');
            }*/

            addNewIpRecord(ip, post_url);
            addPostVisitedTimes();
        }
    }, function(error) {
        addPostVisitedTimes();
    });
}

function addPostVisitedTimes() {
    var AV_Posts = AV.Object.extend("Posts");
    var url = curUrl;
    var title = "About";
    var query = new AV.Query(AV_Posts);

    query.equalTo("post_url", url);
    query.find().then(function(results) {
        if (results.length &gt; 0) {
            curPost = results[0];
            curPost.increment("visited_times");
            curPost.save();
            loadLikeNums();
        } else {
            curPost = new AV_Posts();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            curPost.setACL(acl);
            /* End Set ACL */
            curPost.set("post_title", title);
            curPost.set("post_url", url);
            curPost.set("visited_times", 1);
            curPost.set('like_times', 0);
            curPost.save();
        }
    }, function(error) {
        console.log('Error:' + error.code + " " + error.message);
    });
}

function showPostVisitedTimes() {
    var AV_Posts = AV.Object.extend("Posts");

    var $visitors = $(".leancloud_visitors");
    var url = $visitors.attr('id').trim();
    var title = $visitors.attr('data-flag-title').trim();
    var query = new AV.Query(AV_Posts);

    query.equalTo("post_url", url);
    query.find().then(function(results) {
        if (results.length &gt; 0) {
            curPost = results[0];
            loadLikeNums();
        } else {
            /*if(window.console){
                console.log('异常情况，不应该没记录的');
            }*/
        }
    }, function(error) {
        console.log('Error:' + error.code + " " + error.message);
    });
}

function updateIpRecord(){
    var lastTime = curIpVisitRecord.updatedAt;
    var curTime = new Date();

    var timePassed = curTime.getTime() - lastTime.getTime();

    if(timePassed &gt; 1 * 60 * 1000) {
        /*if(window.console){
            console.log('距离该IP上一次访问该文章已超过了1分钟，更新访问记录，并增加访问次数');
        }*/

        addPostVisitedTimes();

        curIpVisitRecord.save();
    } else {
        /*console.log('这是该IP 1分钟内重复访问该文章，不更新访问记录，不增加访问次数');*/
    }
}

function addNewIpRecord(ip, post_url){
    var Visitor = AV.Object.extend("visitors_record");

    curIpVisitRecord = new Visitor();
    /* Set ACL */
    var acl = new AV.ACL();
    acl.setPublicReadAccess(true);
    acl.setPublicWriteAccess(true);
    curIpVisitRecord.setACL(acl);
    curIpVisitRecord.set("visitor_ip", ip);
    curIpVisitRecord.set("post_url", post_url);
    curIpVisitRecord.set("like_this_post", 0);
    curIpVisitRecord.save();
}

function loadLikeNums() {
    var likeTimes = curPost.get('like_times');
    $("#likeNum").text(likeTimes);
}

function refreshLikeBtn() {
    var likeState = curIpVisitRecord.get('like_this_post');
    if(likeState == 1){
        $("#likeBtn").css("color", "red");
        $("#likeBtn").attr("onclick", "likePost(-1)");
    } else {
        $("#likeBtn").css("color", "black");
        $("#likeBtn").attr("onclick", "likePost(1)");
    }
    loadLikeNums();
}

function likePost(type) {
    if(curPost == null || curIpVisitRecord == null) {
        alert('别点那么快...请稍等...');
    }
    var newNum;
    var getlikeTime = curPost.get('like_times');
    if(typeof getlikeTime == "undefined" || getlikeTime == null || getlikeTime == "")
    {
        newNum = parseInt(type);
    }else{
        newNum = parseInt(type) + parseInt(getlikeTime);
    }

    curPost.set('like_times', newNum);
    curPost.save().then(function(curPost){
        var likeThisPost = type == -1 ? 0 : 1;
        curIpVisitRecord.set("like_this_post", likeThisPost);
        curIpVisitRecord.save().then(function(){
            refreshLikeBtn();
        });
    },function(error){
        console.log('Failed to create visitor record, with error message: ' + error.message);
    });
}

/*启动执行*/
delayLoadValine(); &lt;/script&gt;
</code></pre></div></div></div><button class="anchor"><i class="fa fa-anchor"></i></button><div class="right"><div class="wrap"><div class="side content"><div> Content</div><ul id="content-side" class="content-ul"></ul></div></div></div></div><script src="/js/pageContent.js " charset="utf-8"></script><footer class="site-footer"><div class="wrapper"><p class="description"> 云上的日子！</p><p class="contact"> Contact me at: <a href="https://github.com/bitfeng" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> <a href="mailto:damonc@126.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a></p><p> 本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次</p></div></footer><div class="back-to-top"> <a href="#top" data-scroll> <i class="fa fa-arrow-up" aria-hidden="true"></i> </a></div><script src=" /js/main.js " charset="utf-8"></script> <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script> <script type="text/javascript"> smoothScroll.init({ speed: 500, easing: 'easeInOutCubic', offset: 20, }); function displayWindowSize() { var w = document.documentElement.clientWidth; var h = document.documentElement.clientHeight; var rightDiv = document.querySelector('.right'); var footer = document.querySelector('.site-footer'); if(!rightDiv || !footer){ return; } if(w <= 1700){ rightDiv.style.display='none'; footer.style.display='none'; }else{ rightDiv.style.display='block'; footer.style.display = "block"; } } window.addEventListener("resize", displayWindowSize); displayWindowSize(); </script>
